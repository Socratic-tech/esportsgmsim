<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esports GM: Personality Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-core: #050505;
            --bg-panel: #0f1115;
            --primary: #00f0ff;
            --secondary: #7000ff;
            --danger: #ff2a6d;
            --warning: #ffcc00;
            --text-main: #e0e6ed;
            --text-dim: #6c7a96;
            --border: #232836;
            
            /* Role Colors */
            --role-duelist: #ff4655;
            --role-controller: #b742ff;
            --role-sentinel: #00f0ff;
            --role-initiator: #ffcc00;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-core);
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- Sidebar --- */
        aside {
            width: 280px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            z-index: 10;
            box-shadow: 5px 0 30px rgba(0,0,0,0.5);
        }

        .brand { font-size: 1.8rem; font-weight: 700; margin-bottom: 2rem; letter-spacing: 2px; color: white; text-transform: uppercase; }
        .brand span { color: var(--primary); }

        .stat-widget { margin-bottom: 1.5rem; }
        .stat-label { font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase; display: flex; justify-content: space-between; margin-bottom: 0.3rem; }
        .stat-value { font-size: 1.4rem; font-family: 'JetBrains Mono', monospace; font-weight: 700; }
        
        .progress-bg { width: 100%; height: 6px; background: #222; border-radius: 3px; margin-top: 5px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        .fill-blue { background: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .fill-purple { background: var(--secondary); box-shadow: 0 0 10px var(--secondary); }
        .fill-red { background: var(--danger); box-shadow: 0 0 10px var(--danger); }

        /* --- Main Content --- */
        main { flex: 1; padding: 3rem; overflow-y: auto; position: relative; }

        h1 { font-size: 3rem; margin-bottom: 1rem; text-transform: uppercase; text-shadow: 0 0 20px rgba(0, 240, 255, 0.2); }
        h2 { font-size: 1.5rem; margin-bottom: 1rem; text-transform: uppercase; color: var(--text-main); }
        p { color: var(--text-dim); max-width: 650px; line-height: 1.6; font-size: 1.1rem; margin-bottom: 2rem; }

        /* --- Cards --- */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        
        .card {
            background: rgba(20, 22, 28, 0.6);
            border: 1px solid var(--border);
            padding: 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .card:hover { border-color: var(--primary); transform: translateY(-3px); background: rgba(20, 22, 28, 0.9); }
        .card.selected { border: 1px solid var(--primary); background: rgba(0, 240, 255, 0.05); box-shadow: inset 0 0 20px rgba(0, 240, 255, 0.1); }

        /* --- PLAYER CARD STYLING --- */
        .player-card {
            display: flex; flex-direction: column; align-items: center; text-align: center;
            border-top: 4px solid var(--text-dim); padding-top: 1.5rem;
        }
        
        .player-avatar {
            width: 70px; height: 70px; border-radius: 50%; margin-bottom: 0.5rem;
            background: #333; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: bold; border: 3px solid rgba(255,255,255,0.1);
        }

        .player-role { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; background: #222; padding: 2px 8px; border-radius: 4px; margin-bottom: 0.5rem; }
        .player-name { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.2rem; color: #fff; }
        
        /* Traits */
        .trait-badge {
            font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; margin-bottom: 1rem;
            font-family: 'JetBrains Mono'; text-transform: uppercase; border: 1px solid rgba(255,255,255,0.2);
        }
        
        .role-duelist { border-top-color: var(--role-duelist); }
        .role-duelist .player-role { color: var(--role-duelist); border: 1px solid var(--role-duelist); }
        
        .role-controller { border-top-color: var(--role-controller); }
        .role-controller .player-role { color: var(--role-controller); border: 1px solid var(--role-controller); }
        
        .role-sentinel { border-top-color: var(--role-sentinel); }
        .role-sentinel .player-role { color: var(--role-sentinel); border: 1px solid var(--role-sentinel); }
        
        .role-initiator { border-top-color: var(--role-initiator); }
        .role-initiator .player-role { color: var(--role-initiator); border: 1px solid var(--role-initiator); }

        /* --- Buttons --- */
        .btn {
            background: var(--primary); color: #000; border: none; padding: 1rem 2rem;
            font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; text-transform: uppercase;
            cursor: pointer; clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            transition: 0.2s;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 25px var(--primary); }
        .btn:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }
        .btn-outline { background: transparent; border: 1px solid var(--text-dim); color: var(--text-dim); }

        /* --- Utilities --- */
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.4s forwards; opacity: 0; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: var(--primary); cursor: pointer; margin-top: -8px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #333; }
    </style>
</head>
<body>

<aside>
    <div class="brand">Esports<span>GM</span></div>
    
    <div class="stat-widget">
        <div class="stat-label">Available Budget</div>
        <div class="stat-value" id="hud-budget">$10,000</div>
    </div>
    <hr style="border: 0; border-bottom: 1px solid var(--border); margin-bottom: 1.5rem;">
    <div class="stat-widget">
        <div class="stat-label"><span>Team Skill</span> <span id="num-skill">40</span></div>
        <div class="progress-bg"><div class="progress-fill fill-blue" id="bar-skill" style="width: 40%"></div></div>
    </div>
    <div class="stat-widget">
        <div class="stat-label"><span>Cohesion</span> <span id="num-cohesion">40</span></div>
        <div class="progress-bg"><div class="progress-fill fill-purple" id="bar-cohesion" style="width: 40%"></div></div>
    </div>
    <div class="stat-widget">
        <div class="stat-label"><span>Burnout Risk</span> <span id="num-risk">10%</span></div>
        <div class="progress-bg"><div class="progress-fill fill-red" id="bar-risk" style="width: 10%"></div></div>
    </div>
</aside>

<main>
    <section id="view-intro" class="fade-in">
        <h1>Season 3: The Rebuild</h1>
        <p>Welcome back, Coach. The previous roster has been dissolved. You need to build a team that balances raw mechanical talent with the mental resilience to survive the league.</p>
        <button class="btn" onclick="game.nextStep()">Initialize System</button>
    </section>

    <section id="view-recruitment" class="hidden fade-in">
        <h2>01 // Recruitment Channels</h2>
        <p>Where are you looking for players? (Select 3)</p>
        <div class="card-grid" id="recruitment-options"></div>
        <div style="display: flex; justify-content: flex-end;">
            <button class="btn" id="btn-recruit-next" onclick="game.nextStep()" disabled>Confirm Channels</button>
        </div>
    </section>

    <section id="view-training" class="hidden fade-in">
        <h2>02 // Training Framework</h2>
        <div style="background: var(--bg-panel); padding: 2rem; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 2rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                <label style="font-weight: 700;">Scrim Schedule Intensity</label>
                <span id="val-hours" style="color: var(--primary)">20 Hours/Week</span>
            </div>
            <input type="range" min="10" max="60" value="20" step="5" oninput="game.updateTraining(this.value)">
            <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-dim);">
                Impact: <span id="training-impact">Sustainable Pace.</span>
            </div>
        </div>
        <h3>Focus Area</h3>
        <div class="card-grid" id="training-focus"></div>
        <div style="display: flex; justify-content: flex-end; gap: 1rem;">
            <button class="btn btn-outline" onclick="game.prevStep()">Back</button>
            <button class="btn" onclick="game.nextStep()">Open Player Pool</button>
        </div>
    </section>

    <section id="view-roster" class="hidden fade-in">
        <h2>03 // Draft Roster</h2>
        <p>Select <strong>5 Players</strong>. Pay attention to their <strong>Personality Traits</strong> â€” a team of "Tilters" will fail, no matter how high their skill is.</p>
        
        <div class="card-grid" id="roster-pool">
            </div>

        <div style="display: flex; justify-content: flex-end; gap: 1rem;">
            <button class="btn btn-outline" onclick="game.prevStep()">Back</button>
            <button class="btn" id="btn-roster-next" onclick="game.nextStep()" disabled>Sign Contracts</button>
        </div>
    </section>

    <section id="view-sim" class="hidden fade-in">
        <h2>04 // League Simulation</h2>
        <div style="background: #08090b; border: 1px solid var(--border); padding: 20px; height: 300px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; border-left: 4px solid var(--primary);" id="sim-terminal">
            <div>> SYSTEM READY.</div>
        </div>
        <div id="sim-results" class="hidden" style="margin-top: 2rem; text-align: center; background: var(--bg-panel); padding: 2rem;">
            <h1 id="final-rank">RANK: 8th Place</h1>
            <p id="final-summary">Season Complete.</p>
            <button class="btn" onclick="location.reload()">New Season</button>
        </div>
        <div class="nav-footer" id="sim-controls" style="margin-top: 2rem; display: flex; justify-content: flex-end; gap: 1rem;">
            <button class="btn btn-outline" onclick="game.prevStep()">Adjust</button>
            <button class="btn" onclick="game.runSimulation()">Execute Season</button>
        </div>
    </section>
</main>

<script>
const DB = {
    recruitment: [
        { id: 'social', title: 'Social Media', desc: 'High volume. Chaotic quality.', cost: 2000, skillMod: 5, riskMod: 5 },
        { id: 'school', title: 'Uni League', desc: 'Disciplined but raw mechanics.', cost: 500, skillMod: 2, riskMod: -5 },
        { id: 'tourney', title: 'Invitational', desc: 'Battle-tested talent.', cost: 3000, skillMod: 8, riskMod: 2 },
        { id: 'scout', title: 'Data Scouts', desc: 'Analytically perfect fits.', cost: 4000, skillMod: 10, riskMod: 0 },
        { id: 'club', title: 'Local LANs', desc: 'Strong vibes, lower skill.', cost: 500, skillMod: 3, riskMod: -10 }
    ],
    focus: [
        { id: 'mech', title: 'Mechanics', desc: 'Aim & Movement.', skill: 10, cohesion: -5 },
        { id: 'vod', title: 'Strategy', desc: 'Map Control Theory.', skill: 5, cohesion: 5 },
        { id: 'bond', title: 'Mental', desc: 'Psychology & Trust.', skill: -2, cohesion: 12 }
    ],
    traits: [
        { label: 'IGL', effect: 'Cohesion++', color: '#00f0ff', skillMod: -5, cohMod: 15, riskMod: 0 },
        { label: 'Prodigy', effect: 'Skill++', color: '#ffcc00', skillMod: 15, cohMod: -5, riskMod: 0 },
        { label: 'Toxic', effect: 'Skill++ / Cohesion--', color: '#ff2a6d', skillMod: 20, cohMod: -20, riskMod: 10 },
        { label: 'Veteran', effect: 'Risk--', color: '#a29bfe', skillMod: 5, cohMod: 5, riskMod: -20 },
        { label: 'Tilter', effect: 'Risk++', color: '#ff7675', skillMod: 10, cohMod: -5, riskMod: 25 },
        { label: 'Vibes', effect: 'Cohesion+', color: '#55efc4', skillMod: -10, cohMod: 20, riskMod: -10 }
    ],
    names: ['Viper', 'Chronos', 'Jinx', 'Neo', 'Frost', 'Ace', 'Ghost', 'Spark', 'Kilo', 'Luna', 'Rift', 'Echo', 'Void', 'Solar']
};

class Game {
    constructor() {
        this.state = { step: 0, budget: 10000, skill: 40, cohesion: 40, risk: 10, recruitment: [], roster: [], pool: [] };
        this.steps = ['intro', 'recruitment', 'training', 'roster', 'sim'];
        this.init();
    }

    init() {
        this.renderRecruitment();
        this.renderFocus();
        this.updateHUD();
    }

    updateHUD() {
        document.getElementById('hud-budget').innerText = '$' + this.state.budget.toLocaleString();
        document.getElementById('num-skill').innerText = Math.floor(this.state.skill);
        document.getElementById('bar-skill').style.width = Math.min(100, this.state.skill) + '%';
        document.getElementById('num-cohesion').innerText = Math.floor(this.state.cohesion);
        document.getElementById('bar-cohesion').style.width = Math.min(100, this.state.cohesion) + '%';
        document.getElementById('num-risk').innerText = this.state.risk + '%';
        document.getElementById('bar-risk').style.width = Math.min(100, this.state.risk) + '%';
    }

    changeStep(d) {
        document.getElementById('view-' + this.steps[this.state.step]).classList.add('hidden');
        this.state.step += d;
        if (this.steps[this.state.step] === 'roster' && this.state.pool.length === 0) this.generatePlayerPool();
        document.getElementById('view-' + this.steps[this.state.step]).classList.remove('hidden');
    }
    nextStep() { this.changeStep(1); }
    prevStep() { this.changeStep(-1); }

    // --- Recruitment ---
    renderRecruitment() {
        document.getElementById('recruitment-options').innerHTML = DB.recruitment.map(opt => `
            <div class="card" onclick="game.toggleRecruit(this, '${opt.id}')">
                <div style="color:var(--primary); font-weight:bold;">$${opt.cost}</div>
                <div style="font-size:1.2rem; font-weight:700; color:white;">${opt.title}</div>
                <div style="font-size:0.9rem; color:var(--text-dim);">${opt.desc}</div>
            </div>
        `).join('');
    }

    toggleRecruit(el, id) {
        const idx = this.state.recruitment.indexOf(id);
        const item = DB.recruitment.find(x => x.id === id);
        if (idx > -1) {
            this.state.recruitment.splice(idx, 1); el.classList.remove('selected');
            this.state.budget += item.cost; this.state.skill -= item.skillMod;
        } else {
            if (this.state.recruitment.length >= 3) return;
            if (this.state.budget < item.cost) { alert('No Budget'); return; }
            this.state.recruitment.push(id); el.classList.add('selected');
            this.state.budget -= item.cost; this.state.skill += item.skillMod;
        }
        document.getElementById('btn-recruit-next').disabled = (this.state.recruitment.length !== 3);
        this.updateHUD();
    }

    // --- Training ---
    updateTraining(val) {
        this.state.risk = val < 30 ? 10 : (val < 50 ? 45 : 85);
        document.getElementById('val-hours').innerText = val + ' Hours';
        const impact = document.getElementById('training-impact');
        impact.innerText = val < 30 ? 'Sustainable.' : (val < 50 ? 'High Growth.' : 'CRITICAL RISK.');
        impact.style.color = val > 50 ? 'var(--danger)' : (val > 30 ? 'var(--warning)' : '#00ff88');
        this.updateHUD();
    }
    renderFocus() {
        document.getElementById('training-focus').innerHTML = DB.focus.map(opt => `
            <div class="card" onclick="game.selectFocus(this, '${opt.id}')">
                <div style="font-weight:700; color:white;">${opt.title}</div>
                <div style="font-size:0.9rem; color:var(--text-dim);">${opt.desc}</div>
            </div>
        `).join('');
    }
    selectFocus(el, id) {
        document.querySelectorAll('#training-focus .card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        const cur = DB.focus.find(x => x.id === id);
        this.state.skill += cur.skill; this.state.cohesion += cur.cohesion;
        this.updateHUD();
    }

    // --- Roster & Traits ---
    generatePlayerPool() {
        const container = document.getElementById('roster-pool');
        container.innerHTML = '';
        const roles = ['Duelist', 'Controller', 'Sentinel', 'Initiator'];
        
        for(let i=0; i<8; i++) {
            const name = DB.names[Math.floor(Math.random() * DB.names.length)];
            const role = roles[Math.floor(Math.random() * roles.length)];
            
            // 1. Select Trait
            const trait = DB.traits[Math.floor(Math.random() * DB.traits.length)];

            // 2. Calculate Stats based on Current Team State + Trait Modifiers
            // We add random variance (Math.random) + Trait specific buffs/debuffs
            let pSkill = Math.floor(this.state.skill + (Math.random() * 15 - 5) + trait.skillMod);
            
            // Clamp skill 0-100
            pSkill = Math.max(10, Math.min(99, pSkill));

            const playerObj = { id: i, name, role, skill: pSkill, trait: trait };
            this.state.pool.push(playerObj);

            // Visuals
            const deg = Math.floor(Math.random() * 360);
            const c1 = Math.floor(Math.random()*16777215).toString(16);
            const c2 = Math.floor(Math.random()*16777215).toString(16);
            
            container.innerHTML += `
                <div class="card player-card role-${role.toLowerCase()}" onclick="game.togglePlayer(this, ${i})">
                    <div class="player-role">${role}</div>
                    <div class="player-avatar" style="background: linear-gradient(${deg}deg, #${c1}, #${c2})">${name[0]}</div>
                    <div class="player-name">${name}</div>
                    
                    <div class="trait-badge" style="color:${trait.color}; border-color:${trait.color}">
                        ${trait.label}: ${trait.effect}
                    </div>

                    <div style="width:100%; padding:0 10px;">
                         <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:var(--text-dim); margin-bottom:4px;">
                            <span>Skill Rating</span> <span>${pSkill}</span>
                         </div>
                         <div class="progress-bg" style="height:4px;"><div class="progress-fill fill-blue" style="width:${pSkill}%"></div></div>
                    </div>
                </div>
            `;
        }
    }

    togglePlayer(el, id) {
        const idx = this.state.roster.indexOf(id);
        const player = this.state.pool.find(p => p.id === id);

        if (idx > -1) {
            // REMOVE Player
            this.state.roster.splice(idx, 1); 
            el.classList.remove('selected');
            
            // Revert Stats
            this.state.cohesion -= player.trait.cohMod;
            this.state.risk -= player.trait.riskMod;
            // Note: We don't revert skill because the "Team Skill" is an average, 
            // but for this simple logic we will just let the visual bar reflect the *impact* on cohesion/risk primarily.
        } else {
            // ADD Player
            if (this.state.roster.length >= 5) return;
            this.state.roster.push(id); 
            el.classList.add('selected');

            // Apply Trait Effects to Global State
            this.state.cohesion += player.trait.cohMod;
            this.state.risk += player.trait.riskMod;
        }
        
        document.getElementById('btn-roster-next').disabled = (this.state.roster.length !== 5);
        this.updateHUD();
    }

    // --- Sim ---
    async runSimulation() {
        document.getElementById('sim-controls').classList.add('hidden');
        const term = document.getElementById('sim-terminal');
        const log = (msg, color='') => {
            const d = document.createElement('div'); 
            d.innerHTML = `> ${msg}`; 
            d.style.marginBottom = '5px';
            if(color) d.style.color = color;
            term.appendChild(d); term.scrollTop = term.scrollHeight;
        };

        // Calculate Total Team Power
        // Average Skill of selected players
        const rosterObjs = this.state.pool.filter(p => this.state.roster.includes(p.id));
        const avgSkill = rosterObjs.reduce((a,b) => a + b.skill, 0) / 5;
        
        const teamPower = avgSkill + (this.state.cohesion * 0.5) - (this.state.risk * 0.5);
        let wins = 0;
        const delay = ms => new Promise(r => setTimeout(r, ms));

        log(`ROSTER LOCKED. AVG SKILL: ${Math.floor(avgSkill)}`);
        await delay(500);

        for(let i=1; i<=5; i++) {
            await delay(800);
            const enemy = 50 + (i * 8); // Difficulty curve
            
            // Check for Trait Triggers (Flavor text)
            if (this.state.risk > 80 && Math.random() > 0.7) {
                const tilter = rosterObjs.find(p => p.trait.label === 'Tilter');
                if(tilter) log(`WARNING: ${tilter.name} is tilting! Performance dropped.`, '#ff2a6d');
            }

            if (teamPower + (Math.random()*20) > enemy) { 
                wins++; 
                log(`Week ${i} vs Rivals: VICTORY`, '#00ff88'); 
            } else { 
                log(`Week ${i} vs Rivals: DEFEAT`, '#ff2a6d'); 
            }
        }

        await delay(1000);
        document.getElementById('sim-results').classList.remove('hidden');
        const title = document.getElementById('final-rank');
        const summ = document.getElementById('final-summary');

        if (wins >= 4) { 
            title.innerText = "CHAMPIONS"; title.style.color = "var(--primary)"; 
            summ.innerText = "The dynasty begins here.";
        } else if (wins >= 2) { 
            title.innerText = "PLAYOFFS"; title.style.color = "var(--warning)"; 
            summ.innerText = "Solid season. Foundation built.";
        } else { 
            title.innerText = "ELIMINATED"; title.style.color = "var(--danger)"; 
            summ.innerText = "Disappointing result. The board is watching.";
        }
    }
}

const game = new Game();
</script>
</body>
</html>
