<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Esports Recruitment, Staff & Outcome Simulator – Wizard (Buttons)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#070b16;
    --panel:#11172b;
    --line:#1f2a52;
    --text:#e8eeff;
    --muted:#b9c8ff;
    --accent:#6aa8ff;
    --good:#10b981;
    --bad:#ef4444;
    --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:radial-gradient(circle at top,#192247 0,#070b16 55%);
    color:var(--text);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    line-height:1.55;
  }
  h1,h2,h3{margin-top:0}
  h1{font-size:1.9rem}
  h2{font-size:1.4rem;color:var(--accent)}
  h3{font-size:1.1rem;color:var(--muted)}

  .container{
    max-width:1100px;
    margin:0 auto;
    padding:16px 16px 80px;
  }

  /* Progress bar & step header */
  .top-bar{
    position:sticky;
    top:0;
    z-index:10;
    background:linear-gradient(to bottom, rgba(7,11,22,0.96), rgba(7,11,22,0.9));
    backdrop-filter:blur(10px);
    padding:10px 0 12px;
    margin-bottom:6px;
  }
  .progress-track{
    width:100%;
    height:6px;
    border-radius:999px;
    background:#1c2440;
    overflow:hidden;
    margin-bottom:8px;
  }
  .progress-fill{
    height:100%;
    width:0;
    border-radius:999px;
    background:linear-gradient(90deg,#6aa8ff,#a5b4fc);
    transition:width 0.35s ease-out;
  }
  .step-labels{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    font-size:0.78rem;
  }
  .step-chip{
    padding:3px 9px;
    border-radius:999px;
    border:1px solid var(--line);
    color:var(--muted);
    display:flex;
    align-items:center;
    gap:5px;
    opacity:0.5;
    transition:all 0.2s ease-out;
  }
  .step-chip span{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:18px;
    height:18px;
    border-radius:999px;
    border:1px solid var(--line);
    font-size:0.7rem;
  }
  .step-chip.active{
    border-color:var(--accent);
    color:var(--accent);
    opacity:1;
    box-shadow:0 0 0 1px rgba(106,168,255,0.25);
  }
  .step-chip.completed{
    opacity:0.9;
  }

  .panel{
    background:var(--panel);
    border-radius:16px;
    padding:18px 20px;
    margin-bottom:18px;
    border:1px solid var(--line);
  }
  label{font-weight:600;display:block;margin:8px 0 4px}
  textarea,input,select{
    width:100%;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #2b355c;
    background:#050815;
    color:var(--text);
    font-family:inherit;
    font-size:0.95rem;
  }
  textarea{resize:vertical;min-height:60px}
  .row{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
  }
  .col{
    flex:1 1 250px;
  }

  button{
    padding:10px 18px;
    border-radius:999px;
    border:none;
    background:var(--accent);
    color:#050815;
    font-weight:700;
    cursor:pointer;
    font-size:0.95rem;
    margin-top:10px;
  }
  button:hover{background:#8dbdff}

  .nav-bar{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:linear-gradient(to top, rgba(7,11,22,0.98), rgba(7,11,22,0.9));
    backdrop-filter:blur(10px);
    border-top:1px solid var(--line);
    padding:8px 16px;
  }
  .nav-inner{
    max-width:1100px;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .step-counter{
    font-size:0.85rem;
    color:var(--muted);
  }
  .nav-buttons{
    display:flex;
    gap:8px;
  }
  .btn-secondary{
    background:transparent;
    border:1px solid var(--line);
    color:var(--muted);
  }
  .btn-secondary:hover{
    background:#11172b;
  }

  .pill{
    display:inline-block;
    padding:2px 10px;
    border-radius:999px;
    font-size:0.75rem;
    font-weight:600;
    background:#050815;
    border:1px solid var(--line);
    margin-right:4px;
    margin-bottom:4px;
  }
  .pill.good{border-color:var(--good);color:var(--good)}
  .pill.bad{border-color:var(--bad);color:var(--bad)}
  .pill.warn{border-color:var(--warn);color:var(--warn)}

  .output-block{
    background:#050815;
    border-radius:12px;
    border:1px solid var(--line);
    padding:12px 14px;
    margin-top:10px;
    white-space:pre-wrap;
    font-size:0.9rem;
  }

  .flex{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
  }
  .metric{
    flex:1 1 160px;
    background:#050815;
    border-radius:12px;
    border:1px solid var(--line);
    padding:10px 12px;
  }
  .metric h4{
    margin:0 0 4px;
    font-size:0.9rem;
    color:var(--muted);
  }
  .metric span{
    font-size:1.1rem;
    font-weight:700;
  }

  .flyer{
    background:#f7f7ff;
    color:#111827;
    border-radius:14px;
    padding:16px 18px;
    margin-top:10px;
  }
  .flyer h2{
    color:#111827;
    text-align:center;
    margin-top:0;
    text-transform:uppercase;
    letter-spacing:1px;
    font-size:1.2rem;
  }
  .flyer hr{
    border:none;
    border-top:2px solid #e5e7eb;
    margin:8px 0 10px;
  }
  .small-note{
    font-size:0.8rem;
    color:var(--muted);
    margin-top:2px;
  }

  .count-tag{
    display:inline-block;
    font-size:0.75rem;
    padding:2px 8px;
    border-radius:999px;
    border:1px solid var(--line);
    margin-left:6px;
    color:var(--muted);
  }

  /* Option button style (for activities, incentives, staff) */
  .option-grid{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }
  .option-btn{
    flex:1 1 220px;
    border-radius:12px;
    padding:8px 10px;
    border:1px solid #2b355c;
    background:#050815;
    color:var(--muted);
    text-align:left;
    font-size:0.85rem;
    cursor:pointer;
    display:flex;
    align-items:flex-start;
    gap:6px;
    transition:all 0.15s ease-out;
  }
  .option-btn span.bullet{
    width:18px;
    height:18px;
    border-radius:999px;
    border:1px solid #2b355c;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:0.75rem;
  }
  .option-btn.selected{
    border-color:var(--accent);
    background:rgba(106,168,255,0.12);
    color:var(--text);
    box-shadow:0 0 0 1px rgba(106,168,255,0.3);
  }
  .option-btn.selected span.bullet{
    border-color:var(--accent);
    background:var(--accent);
    color:#050815;
  }

  /* Player cards */
  .player-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:10px;
    margin-top:10px;
  }
  .player-card{
    border-radius:12px;
    border:1px solid #2b355c;
    background:#050815;
    padding:8px 10px;
    cursor:pointer;
    transition:all 0.15s ease-out;
    font-size:0.8rem;
  }
  .player-card-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:4px;
  }
  .player-name{
    font-weight:600;
    font-size:0.85rem;
  }
  .player-role{
    font-size:0.75rem;
    color:var(--muted);
  }
  .player-stats{
    display:flex;
    flex-wrap:wrap;
    gap:4px 8px;
    margin-top:4px;
  }
  .stat-pill{
    font-size:0.7rem;
    padding:1px 6px;
    border-radius:999px;
    border:1px solid #2b355c;
  }
  .player-card.selected{
    border-color:var(--accent);
    background:rgba(106,168,255,0.18);
    box-shadow:0 0 0 1px rgba(106,168,255,0.35);
  }

  /* Step transitions */
  .step{
    display:none;
    opacity:0;
    transform:translateY(6px);
    transition:opacity 0.25s ease-out, transform 0.25s ease-out;
  }
  .step.active{
    display:block;
    opacity:1;
    transform:translateY(0);
  }

  @media(max-width:720px){
    .row{flex-direction:column}
    .nav-inner{flex-direction:column;align-items:flex-start}
  }
</style>
</head>
<body>
<div class="top-bar">
  <div class="container" style="padding-bottom:0;">
    <div class="progress-track">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="step-labels">
      <div class="step-chip" data-step-label="1"><span>1</span>Recruitment</div>
      <div class="step-chip" data-step-label="2"><span>2</span>Training</div>
      <div class="step-chip" data-step-label="3"><span>3</span>Staff</div>
      <div class="step-chip" data-step-label="4"><span>4</span>Roster</div>
      <div class="step-chip" data-step-label="5"><span>5</span>Simulate</div>
      <div class="step-chip" data-step-label="6"><span>6</span>Reflection</div>
    </div>
  </div>
</div>

<div class="container">

  <h1>Esports Recruitment, Staff & Outcome Simulator</h1>
  <p style="color:var(--muted);max-width:800px">
    Move through each step in order: recruitment → training → staff → roster → season simulation → coach reflection.
  </p>

  <!-- STEP 1: RECRUITMENT -->
  <div class="step active" data-step="1">
    <div class="panel">
      <h2>1️⃣ Recruitment Plan</h2>
      <div class="row">
        <div class="col">
          <label for="teamName">Program / Team Name</label>
          <input id="teamName" placeholder="Example: Lakeside Legends Esports" />
        </div>
        <div class="col">
          <label for="focus">Recruitment Focus</label>
          <select id="focus">
            <option value="balanced">Balanced (Skill + Culture)</option>
            <option value="mechanics">Raw Mechanics First</option>
            <option value="iq">Game Sense & Esports IQ</option>
            <option value="culture">Communication & Team Culture</option>
          </select>
        </div>
      </div>

      <label for="targetGroup">Target Group (who are you recruiting?)</label>
      <textarea id="targetGroup" placeholder="Example: High school students with at least Gold rank and a 2.5+ GPA who want to play in a structured team."></textarea>

      <h3>
        Recruitment Activities
        <span class="count-tag" id="recCountTag">0 / 3 selected</span>
      </h3>
      <div class="option-grid">
        <div class="option-btn recOpt" data-label="Social media campaign (Instagram, TikTok, Discord)">
          <span class="bullet">+</span>
          <div>Social media campaign (Instagram, TikTok, Discord)</div>
        </div>
        <div class="option-btn recOpt" data-label="School announcements and hallway posters">
          <span class="bullet">+</span>
          <div>School announcements and hallway posters</div>
        </div>
        <div class="option-btn recOpt" data-label="In-house tryout tournament">
          <span class="bullet">+</span>
          <div>In-house tryout tournament</div>
        </div>
        <div class="option-btn recOpt" data-label="Counselor & teacher referrals based on grades and behavior">
          <span class="bullet">+</span>
          <div>Counselor & teacher referrals based on grades and behavior</div>
        </div>
        <div class="option-btn recOpt" data-label="Open esports lab / drop-in play sessions">
          <span class="bullet">+</span>
          <div>Open esports lab / drop-in play sessions</div>
        </div>
        <div class="option-btn recOpt" data-label="Collaboration with clubs (STEM, robotics, media, band, etc.)">
          <span class="bullet">+</span>
          <div>Collaboration with other clubs (STEM, robotics, media, band, etc.)</div>
        </div>
        <div class="option-btn recOpt" data-label="Joint events with nearby schools or community centers">
          <span class="bullet">+</span>
          <div>Joint events with nearby schools or community centers</div>
        </div>
      </div>
      <div class="small-note">You may select up to 3 recruitment activities.</div>

      <label for="strategiesOther">Other recruitment ideas (optional)</label>
      <textarea id="strategiesOther" placeholder="Any additional recruitment methods you want to include."></textarea>

      <h3>
        Incentives & Benefits
        <span class="count-tag" id="incCountTag">0 / 3 selected</span>
      </h3>
      <div class="option-grid">
        <div class="option-btn incOpt" data-label="Custom team jerseys and branding">
          <span class="bullet">+</span>
          <div>Custom team jerseys and branding</div>
        </div>
        <div class="option-btn incOpt" data-label="Access to dedicated practice space and gaming equipment">
          <span class="bullet">+</span>
          <div>Access to dedicated practice space and gaming equipment</div>
        </div>
        <div class="option-btn incOpt" data-label="Academic support and grade monitoring for eligibility">
          <span class="bullet">+</span>
          <div>Academic support and grade monitoring for eligibility</div>
        </div>
        <div class="option-btn incOpt" data-label="Leadership roles (captain, shot-caller, analyst, content lead)">
          <span class="bullet">+</span>
          <div>Leadership roles (captain, shot-caller, analyst, content lead)</div>
        </div>
        <div class="option-btn incOpt" data-label="Travel opportunities for tournaments or scrims">
          <span class="bullet">+</span>
          <div>Travel opportunities for tournaments or scrims</div>
        </div>
        <div class="option-btn incOpt" data-label="Support for highlight reels and streaming content">
          <span class="bullet">+</span>
          <div>Support for highlight reels and streaming content</div>
        </div>
      </div>
      <div class="small-note">You may select up to 3 incentives/benefits.</div>

      <label for="incentivesOther">Other incentives (optional)</label>
      <textarea id="incentivesOther" placeholder="Any additional benefits you want to offer."></textarea>

      <button type="button" onclick="generatePlan()">Generate Written Recruitment Plan & Flyer</button>
      <div id="recruitmentPlanOut" class="output-block"></div>

      <h3>Recruitment Flyer Preview</h3>
      <div id="flyer" class="flyer"></div>
    </div>
  </div>

  <!-- STEP 2: TRAINING -->
  <div class="step" data-step="2">
    <div class="panel">
      <h2>2️⃣ Training Framework</h2>
      <div class="row">
        <div class="col">
          <label for="preIntensity">Pre-Season Intensity</label>
          <select id="preIntensity">
            <option value="low">Low (1–2 sessions/week)</option>
            <option value="medium" selected>Medium (3 sessions/week)</option>
            <option value="high">High (4–5 sessions/week)</option>
          </select>
        </div>
        <div class="col">
          <label for="hours">Average Weekly Hours (season)</label>
          <input id="hours" type="number" min="1" max="20" value="6" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Season Training Focus Areas</label>
          <div>
            <label><input type="checkbox" id="tf_mech" checked /> Mechanics</label><br/>
            <label><input type="checkbox" id="tf_strat" checked /> Strategy & VOD Review</label><br/>
            <label><input type="checkbox" id="tf_culture" checked /> Team Culture & Wellness</label>
          </div>
        </div>
        <div class="col">
          <label for="preseason">Pre-Season Activities (summary)</label>
          <textarea id="preseason" placeholder="Example: Aim training, role tryouts, team-building games, scrim block vs local schools, code of conduct & wellness workshop."></textarea>
        </div>
      </div>

      <label for="season">Example Weekly Season Schedule</label>
      <textarea id="season" placeholder="Example:
Mon – Mechanics & micro drills
Wed – VOD review & strategy work
Thu – Scrims vs other schools
Fri – Match day with pre/post match talks"></textarea>

      <label for="monitor">Progress Monitoring & Feedback</label>
      <textarea id="monitor" placeholder="Example: Player goal sheets, stat tracking, wellness check-ins, mid-season 1:1s, end-of-season reflection."></textarea>

      <button type="button" onclick="generateTraining()">Generate Training Framework</button>
      <div id="trainingOut" class="output-block"></div>
    </div>
  </div>

  <!-- STEP 3: STAFF -->
  <div class="step" data-step="3">
    <div class="panel">
      <h2>3️⃣ Staff & Support Team</h2>
      <p style="color:var(--muted);margin-top:0">
        Head Coach is required. Choose up to <strong>4</strong> additional staff roles. Staff choices affect performance, cohesion, and burnout/health risk.
      </p>
      <p class="small-note"><strong>Required:</strong> Head Game Coach (already included in the simulation).</p>

      <h3>
        Staff Roles
        <span class="count-tag" id="staffCountTag">0 / 4 selected</span>
      </h3>
      <div class="option-grid">
        <div class="option-btn staffOpt" data-label="Analyst Coach" data-skill="5" data-cohesion="1" data-risk="-1">
          <span class="bullet">+</span>
          <div><strong>Analyst Coach</strong><br><span style="font-size:0.75rem;">Uses data & VODs to find patterns and strategies.</span></div>
        </div>
        <div class="option-btn staffOpt" data-label="Position Coach" data-skill="4" data-cohesion="1" data-risk="0">
          <span class="bullet">+</span>
          <div><strong>Position Coach</strong><br><span style="font-size:0.75rem;">Specializes in roles/champions to refine skills.</span></div>
        </div>
        <div class="option-btn staffOpt" data-label="Performance Scout" data-skill="3" data-cohesion="0" data-risk="0">
          <span class="bullet">+</span>
          <div><strong>Performance Scout</strong><br><span style="font-size:0.75rem;">Scouts opponents & recruits to improve talent ID and prep.</span></div>
        </div>
        <div class="option-btn staffOpt" data-label="Life Coach / Psychologist" data-skill="1" data-cohesion="5" data-risk="-6">
          <span class="bullet">+</span>
          <div><strong>Life Coach / Psychologist</strong><br><span style="font-size:0.75rem;">Supports mental health, stress, motivation, and team dynamics.</span></div>
        </div>
        <div class="option-btn staffOpt" data-label="Athletic Trainer" data-skill="0" data-cohesion="2" data-risk="-5">
          <span class="bullet">+</span>
          <div><strong>Athletic Trainer</strong><br><span style="font-size:0.75rem;">Addresses posture, injuries, and physical strain from gaming.</span></div>
        </div>
        <div class="option-btn staffOpt" data-label="Fitness Coach" data-skill="1" data-cohesion="2" data-risk="-3">
          <span class="bullet">+</span>
          <div><strong>Fitness Coach</strong><br><span style="font-size:0.75rem;">Builds exercise routines to support performance & health.</span></div>
        </div>
        <div class="option-btn staffOpt" data-label="Nutritionist" data-skill="0" data-cohesion="1" data-risk="-4">
          <span class="bullet">+</span>
          <div><strong>Nutritionist</strong><br><span style="font-size:0.75rem;">Guides healthy eating, hydration, and sleep routines.</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 4: PLAYERS -->
  <div class="step" data-step="4">
    <div class="panel">
      <h2>4️⃣ Virtual Player Pool</h2>
      <p style="color:var(--muted);margin-top:0">
        Choose <strong>exactly 5</strong> players for your roster. Your recruitment focus, staff choices, and training plan will interact with these stats.
      </p>
      <div class="pill good">High Mechanics</div>
      <div class="pill warn">Low Commitment</div>
      <div class="pill bad">High Toxicity</div>
      <h3>
        Roster Selection
        <span class="count-tag" id="playerCountTag">0 / 5 selected</span>
      </h3>
      <div class="player-grid" id="playerGrid"></div>
      <div class="small-note">Tap/click player cards to select. You cannot select more than 5 players.</div>
    </div>
  </div>

  <!-- STEP 5: SIMULATION -->
  <div class="step" data-step="5">
    <div class="panel">
      <h2>5️⃣ Season Simulation</h2>
      <p style="color:var(--muted);margin-top:0">
        When you’re happy with your plan, staff, and roster, click the button below to simulate your season.
      </p>
      <button type="button" onclick="runSimulation()">Simulate Season Outcome</button>

      <div class="flex" style="margin-top:14px;">
        <div class="metric">
          <h4>Team Skill Rating</h4>
          <span id="m_skill">–</span>
        </div>
        <div class="metric">
          <h4>Team Cohesion</h4>
          <span id="m_cohesion">–</span>
        </div>
        <div class="metric">
          <h4>Burnout / Risk</h4>
          <span id="m_risk">–</span>
        </div>
      </div>

      <h3 style="margin-top:14px;">Season Outcome</h3>
      <div id="outcomeSummary" class="output-block"></div>
      <div class="small-note">Tip: If the outcome isn’t what you hoped, go back a step and adjust your plan, staff, or roster, then simulate again.</div>
    </div>
  </div>

  <!-- STEP 6: REFLECTION -->
  <div class="step" data-step="6">
    <div class="panel">
      <h2>6️⃣ Coach Reflection</h2>
      <p style="color:var(--muted);margin-top:0">
        Use your season results to answer the prompts below. Then generate a reflection you can copy into a document or LMS.
      </p>

      <label for="ref1">1. How well did your roster and recruitment choices match your stated recruitment focus?</label>
      <textarea id="ref1"></textarea>

      <label for="ref2">2. How did your training framework <em>and staff choices</em> (coaches, analysts, scouts, life/wellness support) help or hurt your season outcome?</label>
      <textarea id="ref2"></textarea>

      <label for="ref3">3. If you could run another season, what would you change about recruitment, staff, training, or roster selection, and why?</label>
      <textarea id="ref3"></textarea>

      <label for="ref4">4. How does this simulation connect to real-world esports (or traditional sports) program management and player well-being?</label>
      <textarea id="ref4"></textarea>

      <button type="button" onclick="generateReflection()">Generate Reflection Summary</button>
      <div id="reflectionOut" class="output-block"></div>
    </div>
  </div>

</div>

<!-- Bottom navigation -->
<div class="nav-bar">
  <div class="nav-inner">
    <div class="step-counter" id="stepCounter">Step 1 of 6 · Recruitment</div>
    <div class="nav-buttons">
      <button type="button" class="btn-secondary" id="prevBtn" onclick="changeStep(-1)" disabled>Back</button>
      <button type="button" id="nextBtn" onclick="changeStep(1)">Next</button>
    </div>
  </div>
</div>

<script>
/* ---- Data ---- */
const playerPool = [
  {id:1,name:"Alex 'Nova' R.",role:"Flex",mech:88,iq:82,comm:78,team:80,commit:85,toxic:15},
  {id:2,name:"Sam 'Clutch' P.",role:"DPS/Striker",mech:95,iq:76,comm:60,team:62,commit:68,toxic:30},
  {id:3,name:"Jordan 'CoachCam' L.",role:"Support/IGL",mech:70,iq:92,comm:95,team:94,commit:90,toxic:5},
  {id:4,name:"Casey 'SoloQ' M.",role:"Carry",mech:93,iq:80,comm:45,team:40,commit:55,toxic:50},
  {id:5,name:"Riley 'Macro' K.",role:"Analyst/Sub",mech:68,iq:88,comm:82,team:85,commit:88,toxic:10},
  {id:6,name:"Taylor 'Grind' C.",role:"Offense",mech:90,iq:78,comm:70,team:72,commit:95,toxic:10},
  {id:7,name:"Jamie 'Tilt' S.",role:"Flex",mech:80,iq:74,comm:50,team:52,commit:60,toxic:65},
  {id:8,name:"Morgan 'Guardian' D.",role:"Support",mech:72,iq:86,comm:88,team:90,commit:92,toxic:8},
  {id:9,name:"Parker 'Academics' J.",role:"Sub",mech:65,iq:80,comm:75,team:78,commit:98,toxic:5},
  {id:10,name:"Devin 'Popoff' H.",role:"DPS",mech:97,iq:70,comm:55,team:50,commit:70,toxic:40},
  {id:11,name:"Avery 'Glue' F.",role:"Shotcaller",mech:78,iq:88,comm:92,team:96,commit:87,toxic:10},
  {id:12,name:"Quinn 'NewBlood' T.",role:"Rookie",mech:82,iq:68,comm:72,team:75,commit:80,toxic:15}
];

let lastSim = null;
let currentStep = 1;
const totalSteps = 6;

/* ---- Utility ---- */
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

function getSelectedLabels(classSelector){
  const btns = document.querySelectorAll(classSelector + ".selected");
  return Array.from(btns).map(b=>b.dataset.label);
}

function getCheckedPlayers(){
  const cards = document.querySelectorAll(".player-card.selected");
  const ids = Array.from(cards).map(c=>parseInt(c.dataset.id,10));
  return playerPool.filter(p=>ids.includes(p.id));
}

/* ---- Wizard Navigation ---- */
function updateStepUI(){
  const steps = document.querySelectorAll(".step");
  steps.forEach(s=>{
    const stepNum = parseInt(s.dataset.step,10);
    s.classList.toggle("active", stepNum === currentStep);
  });

  const pct = (currentStep-1)/(totalSteps-1)*100;
  document.getElementById("progressFill").style.width = pct + "%";

  const chips = document.querySelectorAll(".step-chip");
  chips.forEach(ch=>{
    const n = parseInt(ch.dataset.stepLabel,10);
    ch.classList.toggle("active", n === currentStep);
    ch.classList.toggle("completed", n < currentStep);
  });

  const names = ["Recruitment","Training","Staff","Roster","Simulation","Reflection"];
  document.getElementById("stepCounter").textContent = `Step ${currentStep} of ${totalSteps} · ${names[currentStep-1]}`;

  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  prevBtn.disabled = currentStep === 1;
  nextBtn.textContent = currentStep === totalSteps ? "Done" : "Next";
}

function changeStep(delta){
  const newStep = currentStep + delta;
  if(newStep < 1 || newStep > totalSteps) return;
  currentStep = newStep;
  updateStepUI();
}

/* ---- Render player cards ---- */
function renderPlayerGrid(){
  const grid = document.getElementById("playerGrid");
  grid.innerHTML = "";
  playerPool.forEach(p=>{
    const card = document.createElement("div");
    card.className = "player-card";
    card.dataset.id = p.id;
    card.innerHTML = `
      <div class="player-card-header">
        <div>
          <div class="player-name">${p.name}</div>
          <div class="player-role">${p.role}</div>
        </div>
      </div>
      <div class="player-stats">
        <span class="stat-pill">Mech: ${p.mech}</span>
        <span class="stat-pill">IQ: ${p.iq}</span>
        <span class="stat-pill">Comm: ${p.comm}</span>
        <span class="stat-pill">Team: ${p.team}</span>
        <span class="stat-pill">Commit: ${p.commit}</span>
        <span class="stat-pill">Toxic: ${p.toxic}</span>
      </div>
    `;
    card.addEventListener("click",()=>{
      const selectedCards = document.querySelectorAll(".player-card.selected");
      const alreadySelected = card.classList.contains("selected");
      if(alreadySelected){
        card.classList.remove("selected");
      }else{
        if(selectedCards.length >= 5) return;
        card.classList.add("selected");
      }
      updateCounts();
    });
    grid.appendChild(card);
  });
}

/* ---- Recruitment Plan / Flyer ---- */
function generatePlan(){
  const teamName = document.getElementById("teamName").value || "Our Esports Program";
  const focus = document.getElementById("focus").value;
  const target = document.getElementById("targetGroup").value;

  const acts = getSelectedLabels(".recOpt");
  const actsOther = document.getElementById("strategiesOther").value.trim();
  const incs = getSelectedLabels(".incOpt");
  const incsOther = document.getElementById("incentivesOther").value.trim();

  let focusText = "";
  if(focus==="balanced") focusText = "We will balance mechanical skill with communication, academics, and positive team culture.";
  else if(focus==="mechanics") focusText = "We will prioritize high mechanical skill and ranked performance while still ensuring baseline culture and academic expectations.";
  else if(focus==="iq") focusText = "We will emphasize game sense, decision-making, and leadership, even if raw mechanics are still developing.";
  else if(focus==="culture") focusText = "We will prioritize communication, coachability, and positive culture as the foundation of our roster.";

  let actsText = acts.length ? acts.map(a=>"• "+a).join("\n") : "(student selects recruitment activities)";
  if(actsOther) actsText += "\n• " + actsOther;

  let incsText = incs.length ? incs.map(a=>"• "+a).join("\n") : "(student selects incentives/benefits)";
  if(incsOther) incsText += "\n• " + incsOther;

  const plan =
`${teamName.toUpperCase()} – RECRUITMENT PLAN
=======================================

Target Group:
${target || "(student fills this in)"}

Recruitment Focus:
${focusText}

Recruitment Activities:
${actsText}

Incentives & Benefits:
${incsText}

Timeline:
• Week 1 – Launch campaign (post flyers, social media, announcements, counselor outreach)
• Week 2 – Interest meeting & Q&A + open lab play
• Week 3 – Tryouts / in-house tournament with code of conduct & wellness overview
• Week 4 – Roster decisions, parent communication, and onboarding meeting
`;

  document.getElementById("recruitmentPlanOut").textContent = plan;

  const flyerDiv = document.getElementById("flyer");
  const actsFlyer = acts.length ? acts.join("; ") : "Watch for announcements and visit the esports lab.";
  const incsFlyer = incs.length ? incs.join("; ") : "Skill development, competition experience, and a positive team environment.";

  flyerDiv.innerHTML = `
    <h2>${teamName || "Join Our Esports Team"}</h2>
    <p style="text-align:center;font-weight:600;margin-bottom:4px;">LEVEL UP • COMPETE • BELONG</p>
    <hr />
    <p><strong>Who We're Looking For</strong><br>${target || "Motivated students who love our game, want to grow, and can be great teammates."}</p>
    <p><strong>Why Join?</strong><br>${incsFlyer}${incsOther ? "<br>"+incsOther : ""}</p>
    <p><strong>How to Get Involved</strong><br>${actsFlyer}</p>
    <p style="text-align:center;margin-top:10px;font-size:0.85rem;">Questions? Visit the esports lab or talk with the program coach.</p>
  `;
}

/* ---- Training Framework ---- */
function generateTraining(){
  const preIntensity = document.getElementById("preIntensity").value;
  const hours = parseInt(document.getElementById("hours").value,10) || 6;
  const preseason = document.getElementById("preseason").value;
  const season = document.getElementById("season").value;
  const monitor = document.getElementById("monitor").value;

  let preTxt = "";
  if(preIntensity==="low") preTxt = "Low-intensity pre-season with 1–2 sessions per week focused on fundamentals and setting expectations.";
  else if(preIntensity==="medium") preTxt = "Balanced pre-season with ~3 sessions per week focused on mechanics, team roles, and basic team systems.";
  else preTxt = "High-intensity pre-season with 4–5 structured sessions per week building advanced strategies and deep coordination.";

  const mech = document.getElementById("tf_mech").checked;
  const strat = document.getElementById("tf_strat").checked;
  const cult = document.getElementById("tf_culture").checked;

  let focusAreas = [];
  if(mech) focusAreas.push("mechanics & individual skill");
  if(strat) focusAreas.push("strategy, VOD review, and macro decision-making");
  if(cult) focusAreas.push("team culture, communication, wellness, and mental health");
  if(focusAreas.length===0) focusAreas.push("unstructured play (no clear focus selected)");

  const out =
`TRAINING FRAMEWORK
===================

Pre-Season Overview:
${preTxt}

Pre-Season Activities:
${preseason || "(student fills this in)"}

Season Training Focus:
We will emphasize ${focusAreas.join(", ")} across the season.

Weekly Time Commitment:
Approximately ${hours} hours per week of structured esports activities (mix of practice, review, wellness, and matches).

Example Weekly Schedule:
${season || "(student fills this in)"}

Progress Monitoring & Feedback:
${monitor || "(student fills this in)"}
`;

  document.getElementById("trainingOut").textContent = out;
}

/* ---- Simulation ---- */
function runSimulation(){
  const roster = getCheckedPlayers();
  if(roster.length!==5){
    alert("Select exactly 5 players before simulating.");
    currentStep = 4;
    updateStepUI();
    return;
  }

  const focus = document.getElementById("focus").value;
  const preIntensity = document.getElementById("preIntensity").value;
  const hours = parseInt(document.getElementById("hours").value,10) || 6;

  // base player averages
  let avgMech=0,avgIQ=0,avgComm=0,avgTeam=0,avgCommit=0,avgToxic=0;
  roster.forEach(p=>{
    avgMech+=p.mech;
    avgIQ+=p.iq;
    avgComm+=p.comm;
    avgTeam+=p.team;
    avgCommit+=p.commit;
    avgToxic+=p.toxic;
  });
  const n = roster.length;
  avgMech/=n; avgIQ/=n; avgComm/=n; avgTeam/=n; avgCommit/=n; avgToxic/=n;

  // base scores
  let skill = (avgMech*0.55 + avgIQ*0.45);
  let cohesion = (avgComm*0.5 + avgTeam*0.5);
  let fatigue = 0;

  // training focus modifiers
  const mechFocus = document.getElementById("tf_mech").checked;
  const stratFocus = document.getElementById("tf_strat").checked;
  const cultFocus = document.getElementById("tf_culture").checked;

  if(mechFocus) skill += 4;
  if(stratFocus) skill += 3;
  if(cultFocus) cohesion += 6;

  // pre-season intensity
  if(preIntensity==="low"){ skill -= 3; }
  else if(preIntensity==="high"){ skill += 5; fatigue += 6; }

  // weekly hours impact risk
  if(hours<=4){ cohesion += 2; }
  else if(hours>=9){ fatigue += 6; }

  // staff modifiers (Head Coach baked in)
  let staffSkill = 6; // head coach baseline
  let staffCoh = 3;
  let staffRisk = -1;
  const staffBtns = document.querySelectorAll(".staffOpt.selected");
  staffBtns.forEach(b=>{
    staffSkill += parseFloat(b.dataset.skill || "0");
    staffCoh += parseFloat(b.dataset.cohesion || "0");
    staffRisk += parseFloat(b.dataset.risk || "0");
  });

  skill += staffSkill*0.3;
  cohesion += staffCoh*0.4;

  let risk = avgToxic*0.5 + (100-avgCommit)*0.3 + fatigue*2;
  risk += staffRisk;

  cohesion -= avgToxic*0.15;
  cohesion = clamp(cohesion,0,100);

  // focus alignment
  let focusBonus=0;
  let focusNote="";
  if(focus==="mechanics"){
    if(avgMech>avgIQ && avgMech>80){ focusBonus+=4; focusNote="Your roster matches your mechanics-first focus."; }
    else{ focusBonus-=3; focusNote="Your roster does not fully match your mechanics-first recruitment focus."; }
  }else if(focus==="iq"){
    if(avgIQ>=avgMech && avgIQ>80){ focusBonus+=4; focusNote="Your roster matches your IQ/decision-making focus."; }
    else{ focusBonus-=3; focusNote="Your roster does not fully support your IQ-focused plan."; }
  }else if(focus==="culture"){
    if(avgComm>80 && avgTeam>80 && avgToxic<25){ focusBonus+=5; focusNote="You built a strong culture roster that fits your plan."; }
    else{ focusBonus-=2; focusNote="Some roster choices work against your culture-first plan."; }
  }else{
    if(avgMech>75 && cohesion>75){ focusBonus+=3; focusNote="Balanced roster with good skill and cohesion."; }
  }

  skill = clamp(skill + focusBonus,0,100);
  risk = clamp(risk/1.5,0,100);

  // outcome tier
  let tier="";
  let notes=[];
  if(skill>=85 && cohesion>=75 && risk<=45){
    tier="Championship Contender";
    notes.push("Your team has high skill, strong cohesion, and manageable burnout risk.");
  }else if(skill>=75 && cohesion>=60 && risk<=60){
    tier="Playoff-Level Team";
    notes.push("You can consistently compete with strong teams, but refinement is needed for a deep run.");
  }else if(skill>=65 && cohesion>=45){
    tier="Inconsistent Bubble Team";
    notes.push("Some days you upset stronger teams, other days internal issues hold you back.");
  }else{
    tier="Struggling Roster";
    notes.push("Talent, culture, and/or workload are misaligned. Major adjustments are needed.");
  }

  if(avgToxic>40){
    notes.push("High toxicity is dragging down cohesion and long-term success. Consider culture standards in recruitment.");
  }
  if(avgCommit<70){
    notes.push("Low average commitment increases risk of no-shows, burnout, or academic ineligibility.");
  }
  if(mechFocus && !document.getElementById("tf_mech").checked){
    notes.push("You recruited for mechanics but did not emphasize mechanics enough in training.");
  }
  if(cultFocus && !document.getElementById("tf_culture").checked){
    notes.push("You recruited for culture but did not protect it with dedicated culture/wellness time.");
  }
  if(hours>10){
    notes.push("Heavy weekly hours increase burnout risk. Consider reducing load or adding structured breaks.");
  }
  if(hours<4){
    notes.push("Very low weekly hours may limit skill growth compared to other programs.");
  }

  document.getElementById("m_skill").textContent = Math.round(skill);
  document.getElementById("m_cohesion").textContent = Math.round(cohesion);
  document.getElementById("m_risk").textContent = Math.round(risk);

  const teamName = document.getElementById("teamName").value || "Your Team";
  const rosterList = roster.map(p=>`• ${p.name} (${p.role})`).join("\n");
  const staffList = getSelectedLabels(".staffOpt");
  staffList.unshift("Head Game Coach");

  let summary =
`${teamName.toUpperCase()} – SEASON SUMMARY
Outcome Tier: ${tier}

Roster Selected:
${rosterList}

Staff & Support Team:
${staffList.map(s=>"• "+s).join("\n")}

Key Metrics:
• Team Skill Rating: ${Math.round(skill)}/100
• Team Cohesion: ${Math.round(cohesion)}/100
• Burnout / Risk Level: ${Math.round(risk)}/100

Focus Alignment:
${focusNote || "Your roster has a mixed alignment with your stated recruitment focus."}

Coach Notes:
- Avg Mechanics: ${Math.round(avgMech)}
- Avg Game Sense / IQ: ${Math.round(avgIQ)}
- Avg Communication: ${Math.round(avgComm)}
- Avg Team Orientation: ${Math.round(avgTeam)}
- Avg Commitment: ${Math.round(avgCommit)}
- Avg Toxicity: ${Math.round(avgToxic)}
`;

  if(notes.length){
    summary += `\nSuggestions for Improvement:\n${notes.map(n=>`• ${n}`).join("\n")}`;
  }

  document.getElementById("outcomeSummary").textContent = summary;

  lastSim = {
    teamName,
    tier,
    skill: Math.round(skill),
    cohesion: Math.round(cohesion),
    risk: Math.round(risk)
  };

  currentStep = 6;
  updateStepUI();
}

/* ---- Reflection ---- */
function generateReflection(){
  if(!lastSim){
    alert("Run the season simulation first so you have results to reflect on.");
    return;
  }
  const r1 = document.getElementById("ref1").value || "(student response)";
  const r2 = document.getElementById("ref2").value || "(student response)";
  const r3 = document.getElementById("ref3").value || "(student response)";
  const r4 = document.getElementById("ref4").value || "(student response)";

  const text =
`${lastSim.teamName.toUpperCase()} – COACH REFLECTION

Season Outcome:
• Tier: ${lastSim.tier}
• Team Skill: ${lastSim.skill}/100
• Cohesion: ${lastSim.cohesion}/100
• Burnout / Risk: ${lastSim.risk}/100

1. Alignment between recruitment focus, roster, and outcome:
${r1}

2. Impact of training framework and staff choices (coaches, analysts, scouts, wellness support):
${r2}

3. Changes for next season (recruitment, staff, training, roster choices):
${r3}

4. Connection to real-world esports/sports program management and player well-being:
${r4}
`;

  document.getElementById("reflectionOut").textContent = text;
}

/* ---- Counters & Limits ---- */
function updateCounts(){
  const recCount = document.querySelectorAll(".recOpt.selected").length;
  const incCount = document.querySelectorAll(".incOpt.selected").length;
  const staffCount = document.querySelectorAll(".staffOpt.selected").length;
  const playerCount = document.querySelectorAll(".player-card.selected").length;

  document.getElementById("recCountTag").textContent = `${recCount} / 3 selected`;
  document.getElementById("incCountTag").textContent = `${incCount} / 3 selected`;
  document.getElementById("staffCountTag").textContent = `${staffCount} / 4 selected`;
  document.getElementById("playerCountTag").textContent = `${playerCount} / 5 selected`;
}

function setupOptionButtons(){
  // generic handler for recOpt (limit 3), incOpt (limit 3), staffOpt (limit 4)
  function setupGroup(className, limit){
    const btns = document.querySelectorAll(className);
    btns.forEach(btn=>{
      btn.addEventListener("click",()=>{
        const selectedBtns = document.querySelectorAll(className + ".selected");
        const alreadySelected = btn.classList.contains("selected");
        if(alreadySelected){
          btn.classList.remove("selected");
        }else{
          if(selectedBtns.length >= limit) return;
          btn.classList.add("selected");
        }
        updateCounts();
      });
    });
  }

  setupGroup(".recOpt",3);
  setupGroup(".incOpt",3);
  setupGroup(".staffOpt",4);
}

/* ---- Init ---- */
renderPlayerGrid();
setupOptionButtons();
updateCounts();
updateStepUI();
</script>
</body>
</html>
